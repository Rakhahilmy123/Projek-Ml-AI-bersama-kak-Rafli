<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes Prediction System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        medical: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-medical-50 to-blue-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center">
                    <i class="fas fa-heartbeat text-medical-600 text-3xl mr-3"></i>
                    <h1 class="text-3xl font-bold text-gray-900">Diabetes Prediction System</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="modelStatus" class="flex items-center">
                        <div class="w-3 h-3 bg-gray-400 rounded-full mr-2"></div>
                        <span class="text-sm text-gray-600">Checking model...</span>
                    </div>
                    <button id="retrainBtn" class="bg-medical-600 text-white px-4 py-2 rounded-lg hover:bg-medical-700 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Retrain Model
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Input Form -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-xl p-8">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Input Data Pasien</h2>
                        <p class="text-gray-600">Masukkan data kesehatan untuk prediksi diabetes</p>
                    </div>

                    <form id="predictionForm" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Pregnancies -->
                            <div class="form-group">
                                <label for="pregnancies" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-baby text-medical-600 mr-2"></i>Jumlah Kehamilan
                                </label>
                                <input type="number" id="pregnancies" name="pregnancies" min="0" max="20" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 6" required>
                                <p class="text-xs text-gray-500 mt-1">Jumlah kehamilan yang pernah dialami</p>
                            </div>

                            <!-- Glucose -->
                            <div class="form-group">
                                <label for="glucose" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-vial text-medical-600 mr-2"></i>Kadar Glukosa
                                </label>
                                <input type="number" id="glucose" name="glucose" min="0" max="300" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 148" required>
                                <p class="text-xs text-gray-500 mt-1">Kadar glukosa dalam darah (mg/dL)</p>
                            </div>

                            <!-- Blood Pressure -->
                            <div class="form-group">
                                <label for="bloodPressure" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-thermometer-half text-medical-600 mr-2"></i>Tekanan Darah
                                </label>
                                <input type="number" id="bloodPressure" name="bloodPressure" min="0" max="200" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 72" required>
                                <p class="text-xs text-gray-500 mt-1">Tekanan darah diastolik (mmHg)</p>
                            </div>

                            <!-- Skin Thickness -->
                            <div class="form-group">
                                <label for="skinThickness" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-ruler text-medical-600 mr-2"></i>Ketebalan Kulit
                                </label>
                                <input type="number" id="skinThickness" name="skinThickness" min="0" max="100" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 35" required>
                                <p class="text-xs text-gray-500 mt-1">Ketebalan lipatan kulit triceps (mm)</p>
                            </div>

                            <!-- Insulin -->
                            <div class="form-group">
                                <label for="insulin" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-syringe text-medical-600 mr-2"></i>Kadar Insulin
                                </label>
                                <input type="number" id="insulin" name="insulin" min="0" max="1000" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 0" required>
                                <p class="text-xs text-gray-500 mt-1">Kadar insulin 2 jam setelah makan (mu U/ml)</p>
                            </div>

                            <!-- BMI -->
                            <div class="form-group">
                                <label for="bmi" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-weight text-medical-600 mr-2"></i>BMI (Body Mass Index)
                                </label>
                                <input type="number" id="bmi" name="bmi" min="0" max="70" step="0.1" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 33.6" required>
                                <p class="text-xs text-gray-500 mt-1">Indeks massa tubuh (kg/mÂ²)</p>
                            </div>

                            <!-- Diabetes Pedigree Function -->
                            <div class="form-group">
                                <label for="diabetesPedigreeFunction" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-dna text-medical-600 mr-2"></i>Fungsi Keturunan Diabetes
                                </label>
                                <input type="number" id="diabetesPedigreeFunction" name="diabetesPedigreeFunction" 
                                       min="0" max="3" step="0.001" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 0.627" required>
                                <p class="text-xs text-gray-500 mt-1">Fungsi riwayat keluarga diabetes</p>
                            </div>

                            <!-- Age -->
                            <div class="form-group">
                                <label for="age" class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-calendar-alt text-medical-600 mr-2"></i>Usia
                                </label>
                                <input type="number" id="age" name="age" min="1" max="120" 
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-medical-500 focus:border-transparent"
                                       placeholder="Contoh: 50" required>
                                <p class="text-xs text-gray-500 mt-1">Usia pasien (tahun)</p>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex justify-center pt-6">
                            <button type="submit" 
                                    class="bg-gradient-to-r from-medical-600 to-medical-700 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:from-medical-700 hover:to-medical-800 transform hover:scale-105 transition-all duration-200 shadow-lg">
                                <i class="fas fa-chart-line mr-2"></i>Prediksi Diabetes
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-2xl shadow-xl p-8 sticky top-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-6">Hasil Prediksi</h3>
                    
                    <div id="resultContainer" class="hidden">
                        <!-- Prediction Result -->
                        <div id="predictionResult" class="mb-6 p-4 rounded-lg text-center">
                            <div id="resultIcon" class="text-4xl mb-3"></div>
                            <div id="resultText" class="text-xl font-bold mb-2"></div>
                            <div id="resultSubtext" class="text-sm"></div>
                        </div>

                        <!-- Confidence Level -->
                        <div class="mb-6">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium text-gray-700">Tingkat Kepercayaan</span>
                                <span id="confidencePercent" class="text-sm font-bold text-medical-600"></span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div id="confidenceBar" class="bg-medical-600 h-3 rounded-full transition-all duration-500"></div>
                            </div>
                        </div>

                        <!-- Probability Breakdown -->
                        <div class="mb-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-3">Probabilitas Detail</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Tidak Diabetes:</span>
                                    <span id="probNoPrediabetes" class="text-sm font-medium text-green-600"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Diabetes:</span>
                                    <span id="probDiabetes" class="text-sm font-medium text-red-600"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Model Info -->
                        <div class="border-t pt-4">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Informasi Model</h4>
                            <div class="text-xs text-gray-500">
                                <div>Algoritma: Logistic Regression</div>
                                <div id="modelAccuracy">Akurasi: Loading...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Default State -->
                    <div id="defaultState" class="text-center py-12">
                        <i class="fas fa-chart-pie text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">Masukkan data pasien untuk melihat hasil prediksi</p>
                    </div>

                    <!-- Loading State -->
                    <div id="loadingState" class="hidden text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-medical-600 mx-auto mb-4"></div>
                        <p class="text-gray-500">Memproses prediksi...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center text-gray-500">
                <p>&copy; 2024 Diabetes Prediction System. Powered by Machine Learning & Flask.</p>
                <p class="text-sm mt-2">Disclaimer: Hasil prediksi ini hanya untuk referensi. Selalu konsultasikan dengan dokter untuk diagnosis yang akurat.</p>
            </div>
        </div>
    </footer>

    <script>
        // Check model status on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkModelStatus();
        });

        // Check model status
        async function checkModelStatus() {
            try {
                const response = await fetch('/api/model-info');
                const data = await response.json();
                
                const statusElement = document.getElementById('modelStatus');
                if (response.ok) {
                    statusElement.innerHTML = `
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-sm text-green-600">Model Ready (${(data.accuracy * 100).toFixed(1)}% accuracy)</span>
                    `;
                    document.getElementById('modelAccuracy').textContent = `Akurasi: ${(data.accuracy * 100).toFixed(1)}%`;
                } else {
                    statusElement.innerHTML = `
                        <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                        <span class="text-sm text-red-600">Model Error</span>
                    `;
                }
            } catch (error) {
                console.error('Error checking model status:', error);
                const statusElement = document.getElementById('modelStatus');
                statusElement.innerHTML = `
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                    <span class="text-sm text-red-600">Connection Error</span>
                `;
            }
        }

        // Form submission
        document.getElementById('predictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            document.getElementById('defaultState').classList.add('hidden');
            document.getElementById('resultContainer').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            
            // Collect form data
            const formData = new FormData(this);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = parseFloat(value);
            }
            
            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    displayResult(result);
                } else {
                    throw new Error(result.error || 'Prediction failed');
                }
                
            } catch (error) {
                console.error('Error:', error);
                alert('Terjadi kesalahan saat melakukan prediksi: ' + error.message);
                
                // Show default state
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('defaultState').classList.remove('hidden');
            }
        });

        // Display prediction result
        function displayResult(result) {
            // Hide loading state
            document.getElementById('loadingState').classList.add('hidden');
            
            // Update result display
            const resultContainer = document.getElementById('resultContainer');
            const predictionResult = document.getElementById('predictionResult');
            const resultIcon = document.getElementById('resultIcon');
            const resultText = document.getElementById('resultText');
            const resultSubtext = document.getElementById('resultSubtext');
            
            if (result.prediction === 1) {
                predictionResult.className = 'mb-6 p-4 rounded-lg text-center bg-red-50 border border-red-200';
                resultIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-red-500"></i>';
                resultText.innerHTML = '<span class="text-red-700">Diabetes</span>';
                resultSubtext.innerHTML = '<span class="text-red-600">Pasien memiliki indikasi diabetes</span>';
            } else {
                predictionResult.className = 'mb-6 p-4 rounded-lg text-center bg-green-50 border border-green-200';
                resultIcon.innerHTML = '<i class="fas fa-check-circle text-green-500"></i>';
                resultText.innerHTML = '<span class="text-green-700">Tidak Diabetes</span>';
                resultSubtext.innerHTML = '<span class="text-green-600">Pasien tidak menunjukkan indikasi diabetes</span>';
            }
            
            // Update confidence level
            const confidence = (result.confidence * 100).toFixed(1);
            document.getElementById('confidencePercent').textContent = confidence + '%';
            document.getElementById('confidenceBar').style.width = confidence + '%';
            
            // Update probability breakdown
            document.getElementById('probNoPrediabetes').textContent = (result.probability.no_diabetes * 100).toFixed(1) + '%';
            document.getElementById('probDiabetes').textContent = (result.probability.diabetes * 100).toFixed(1) + '%';
            
            // Show result container
            resultContainer.classList.remove('hidden');
        }

        // Retrain model
        document.getElementById('retrainBtn').addEventListener('click', async function() {
            if (confirm('Apakah Anda yakin ingin melatih ulang model? Proses ini mungkin memakan waktu beberapa detik.')) {
                const button = this;
                const originalText = button.innerHTML;
                
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Retraining...';
                button.disabled = true;
                
                try {
                    const response = await fetch('/api/retrain', {
                        method: 'POST'
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        alert('Model berhasil dilatih ulang dengan akurasi: ' + (result.accuracy * 100).toFixed(1) + '%');
                        checkModelStatus(); // Update status
                    } else {
                        throw new Error(result.error || 'Retrain failed');
                    }
                    
                } catch (error) {
                    console.error('Error:', error);
                    alert('Gagal melatih ulang model: ' + error.message);
                } finally {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }
        });

        // Auto-fill example data
        function fillExampleData() {
            document.getElementById('pregnancies').value = 6;
            document.getElementById('glucose').value = 148;
            document.getElementById('bloodPressure').value = 72;
            document.getElementById('skinThickness').value = 35;
            document.getElementById('insulin').value = 0;
            document.getElementById('bmi').value = 33.6;
            document.getElementById('diabetesPedigreeFunction').value = 0.627;
            document.getElementById('age').value = 50;
        }

        document.addEventListener('DOMContentLoaded', function() {
        });
    </script>
</body>
</html>